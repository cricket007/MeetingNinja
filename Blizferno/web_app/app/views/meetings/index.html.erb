<!-- The tasks in the GET POST requests need to be changed to meetings. Implement a check on edit so it doesn't fuck up the backend db (db? more like dp.)-->
<script type = 'text/javascript'>
  
  /*
    function hideViewModal(){
     $('#viewMeetingModel').modal('hide');
    }
    function showViewModal2(){
     $('#viewMeetingModal').modal('show');
     $('#editMeetingModal').modal('hide');
    }
    function showViewModal(ID){
      $('#viewMeetingModal').modal('show');
    }
  */

  var currentID;
  var deleteID;
  var meetingsJSON = <%= raw @meetings %>;
	meetingsJSON = JSON.parse("["+meetingsJSON.toString()+"]");

  function hideMeetingModal(){
    $('#viewMeetingModal').modal('hide');
  }

  function showEditModal(){
    $('#editMeetingModal').modal('hide');
    $('#editMeetingModal').on('hidden.bs.modal', function() {
      $(this).removeData('bs.modal');
    });
    
    // TODO: Put this back in when it works
    // $.ajax({
    //         type: 'GET',
    //         url: 'http://csse371-04.csse.rose-hulman.edu/Tasks/' + ID,
    //   success:function(data){
    //     if(data.taskID != null){
    //       TaskArray = JSON.parse(data);
    //     }
    //   }
    // });

    document.getElementById("titleE").value = meetingsJSON[currentID]["title"];
	document.getElementById("descriptionE").value = meetingsJSON[currentID]["description"];
    document.getElementById("locationE").value = meetingsJSON[currentID]["location"];
    document.getElementById("datetimeE").value = meetingsJSON[currentID]["datetime"];
    // document.getElementById("attendanceE").value = TaskArray["attendance"];

    $('#editMeetingModal').modal('show');
    $('#viewMeetingModal').modal('hide');
  }

  function updateEditedValues(){
	
  }

  function showDeleteModal(ID){
    deleteID = ID;
    $('#deleteMeetingModal').modal('show');
  }

  function hideDeleteModal(){
    // TODO: Put this back in when it works and change it to the delete
     $.ajax({
             type: 'DELETE',
             url: 'http://csse371-04.csse.rose-hulman.edu/Meeting/' + meetingsJSON[deleteID]['meetingID'],
       success:function(data){
         if(data.deleted == true){
			delete meetingsJSON[deleteID];
         }
       }
     });
    //alert("The task matching id " + deleteID + " was deleted");

    $('#deleteMeetingModal').modal('hide');
    // TODO: Put back in
    //location.reload(true);
  }

  function showMeetingModalNoID(){
    $('#viewMeetingModal').modal('hide');
    $('#viewMeetingModal').on('hidden.bs.modal', function() {
      $(this).removeData('bs.modal');
    });

    // Edit info
    meetingsJSON[currentID]["title"] = document.getElementById("titleE").value;
	meetingsJSON[currentID]["description"] = document.getElementById("descriptionE").value;
    meetingsJSON[currentID]["location"] = document.getElementById("locationE").value;
    meetingsJSON[currentID]["datetime"] = document.getElementById("datetimeE").value;

    // TODO: Put this back in when it works and change it to update info then add a pull
    // $.ajax({
    //         type: '',
    //         url: 'http://csse371-04.csse.rose-hulman.edu/Tasks/' + ID,
    //   success:function(data){
    //     if(data.taskID != null){
    //       TaskArray = JSON.parse(data);
    //     }
    //   }
    // });

    // Update view info
    document.getElementById("titleV").innerHTML = meetingsJSON[currentID]["title"];
	document.getElementyById("descriptionV").innerHTML = meetingsJSON[currentID]["description"];
    document.getElementById("locationV").innerHTML = meetingsJSON[currentID]["location"];
    document.getElementById("datetimeV").innerHTML = meetingsJSON[currentID]["datetime"];
    // document.getElementById("attendanceV").innerHTML = TaskArray["attendance"];

    $('#viewMeetingModal').modal('show');
    $('#editMeetingModal').modal('hide');
  }

  function showViewMeetingModal(ID){
    $('#viewMeetingModal').modal('hide');
    $('#viewMeetingModal').on('hidden.bs.modal', function() {
      $(this).removeData('bs.modal');
    });

	currentID = ID;

    document.getElementById("titleV").innerHTML = meetingsJSON[currentID]["title"];
	document.getElementById("descriptionV").innerHTML = meetingsJSON[currentID]["description"];
    document.getElementById("locationV").innerHTML = meetingsJSON[currentID]["location"];
    document.getElementById("datetimeV").innerHTML = meetingsJSON[currentID]["datetime"];

    $('#viewMeetingModal').modal('show');
    $('#editMeetingModal').modal('hide');
  }

  function validateForm()
  {//QUESTION: Is this function used/planned for something?
  
  var title = document.forms["input"]["title"].value;
  // var attendees = document.forms["input"]["attendees"].value;
  var datetime = document.forms["input"]["datetime"].value;
  var location = document.forms["input"]["location"].value;
  alert("The following fields were added to the db: " + title + " " + datetime + " " + location);

    return true;
  }
</script>

<!-- Create Modal -->
<div class="modal fade" id="newMeetingModal" tabindex="-1" role="dialog" aria-labelledby="newMeetingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Create Meeting</h4>
      </div>
      <div class="modal-body">
        <%= render "new" %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" form="createMeeting">Submit</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Delete Modal -->
<div class="modal fade" id="deleteMeetingModal" tabindex="-1" role="dialog" aria-labelledby="deleteMeetingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Delete Meeting</h4>
      </div>
      <div class="modal-body">
        <%= render "delete" %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="hideDeleteModal()">Delete</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- View Modal -->
<div class="modal fade" id="viewMeetingModal" tabindex="-1" role="dialog" aria-labelledby="viewMeetingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">View Meeting</h4>
      </div>
      <div class="modal-body">
        <%= render "view" %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="showEditModal()" href="#editMeetingModal" data-refresh="true" data-toggle='modal'>Edit</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Edit Modal -->
<div class="modal fade" id="editMeetingModal" tabindex="-1" role="dialog" aria-labelledby="editMeetingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Edit </h4>
      </div>
      <div class="modal-body">
        <%= render "edit" %>
      </div>
      <div class="modal-footer">
        <button id="cancelEditButton" type="button" class="btn btn-default" onclick="cancelEdit()" data-refresh="true" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="showMeetingModalNoID()" data-refresh="true" >Save Changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<h1 class='pageTitle'>Meetings</h1>

<table class='table table-hover table-striped' style='width: 70%; margin-left: 15%; margin-right: auto;'>
  <thead>
    <tr>
      <th>Date</th>
      <th>Title</th>
      <th>Where</th>
      <th></th>
      <!-- <th>When</th>
      <th>Project</th>
      <th>Agenda</th> -->
    </tr>
  </thead>
  <% for meeting in @meetingsParsed %>
    <tr>
      <td><%= meeting['datetime'] %></td>
      <td><a onClick="showViewMeetingModal(<%=@meetingsParsed.index(meeting)%>)" href = '#viewMeetingModal' data-refresh = 'true' data-toggle='modal'><%= meeting['title'] %></a></td>
      <td><%= meeting['location'] %></td>
      <td colspan='1' style='cursor: pointer; text-align: center' onclick="showDeleteModal(<%=@meetingsParsed.index(meeting)%>)"  data-refresh="true" data-toggle='modal'><span style='font-size: 1.3em; color: white;' class='glyphicon glyphicon-trash'></span></td>
    </tr>
  <% end %>

  <tr>
    <td colspan='4' style='cursor: pointer; text-align: center' href='#newMeetingModal' data-toggle='modal'><span style='font-size: 1.3em; color: white;' class='glyphicon glyphicon-plus'></span><span style='font-size: 1.1em; color: white;'>  Create New</span></td>
  </tr>
</table>
