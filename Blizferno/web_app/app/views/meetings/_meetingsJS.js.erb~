
var currentID;
var deleteID;
var meetingsJSON = <%= raw @meetings %>;
meetingsJSON = JSON.parse("["+meetingsJSON.toString()+"]");

function hideMeetingModal(){
	$('#viewMeetingModal').modal('hide');
}

function cancelEdit(){
	showViewMeetingModal(currentID);
}

function showEditModal(){
	$('#editMeetingModal').modal('hide');
	$('#editMeetingModal').on('hidden.bs.modal', function() {
		$(this).removeData('bs.modal');
	});

	document.getElementById("titleE").value = meetingsJSON[currentID]["title"];
	document.getElementById("descriptionE").value = meetingsJSON[currentID]["description"];
	document.getElementById("locationE").value = meetingsJSON[currentID]["location"];
	document.getElementById("datetimeE").value = meetingsJSON[currentID]["datetime"];
	// document.getElementById("attendanceE").value = TaskArray["attendance"];

	$('#editMeetingModal').modal('show');
	$('#viewMeetingModal').modal('hide');
}

function updateEditedValues(){

	var editMeetingID = meetingsJSON[currentID]['meetingID'].toString();
	var editField = "";
	var editValue = "";
	var editData = "";


	for (key in meetingsJSON[currentID]){

		if(document.getElementById(key+"E") != null && meetingsJSON[currentID][key] != document.getElementById(key+"E").value){
			meetingsJSON[currentID][key] = document.getElementById(key+"E").value;

			editField = key;
			editValue = meetingsJSON[currentID][key];
			editData = JSON.stringify({"meetingID":editMeetingID,"field":editField,"value":editValue});
alert("meetingID:"+editMeetingID);

alert("editData:"+editData);

			$.ajax({
				type: 'PUT',
				url: 'http://csse371-04.csse.rose-hulman.edu/Meeting/',
				data: editData
			});

		}
	}

}

function showDeleteModal(ID){
	deleteID = ID;
	$('#deleteMeetingModal').modal('show');
}

function hideDeleteModal(){

	var deleteData = meetingsJSON[deleteID]['meetingID'];
	
	$.ajax({
		type: 'DELETE',
		url: 'http://csse371-04.csse.rose-hulman.edu/Meeting/'+deleteData,
		success:function(data){
			if(data.deleted == true){
				delete meetingsJSON[deleteID];
			}
		}
	});

	$('#deleteMeetingModal').modal('hide');
	// TODO: Put back in
	//location.reload(true);
}

function showMeetingModalNoID(){
	updateEditedValues();
	showViewMeetingModal(currentID);
}

function showViewMeetingModal(ID){
	$('#viewMeetingModal').modal('hide');
	$('#viewMeetingModal').on('hidden.bs.modal', function() {
		$(this).removeData('bs.modal');
	});

	currentID = ID;

	document.getElementById("titleV").innerHTML = meetingsJSON[currentID]["title"];
	document.getElementById("descriptionV").innerHTML = meetingsJSON[currentID]["description"];
	document.getElementById("locationV").innerHTML = meetingsJSON[currentID]["location"];
	document.getElementById("datetimeV").innerHTML = meetingsJSON[currentID]["datetime"];

	$('#viewMeetingModal').modal('show');
	$('#editMeetingModal').modal('hide');
}

function validateForm(){
	//QUESTION: Is this function used/planned for something?
	var title = document.forms["input"]["title"].value;
	// var attendees = document.forms["input"]["attendees"].value;
	var datetime = document.forms["input"]["datetime"].value;
	var location = document.forms["input"]["location"].value;
	alert("The following fields were added to the db: " + title + " " + datetime + " " + location);

	return true;
}



