class MeetingsController < ApplicationController

	before_filter :getMeetings

	def index
		if (cookies[:userID].blank?)
			redirect_to '/login/index'
			return
		end
		@meetings2 = JSON.parse('{"meetings":[{"meetingID":"1","title":"Baseball","location":"Room 42","datetime":"01/02/03"}, {"meetingID":"2","title":"Music","location":"Room 8675309","datetime":"04/05/06"},
			{"meetingID":"3","title":"Cars","location":"Room 409","datetime":"07/08/09"},
			{"meetingID":"4","title":"Drink Beer!","location":"Frat Houses","datetime":"10/11/12"},
			{"meetingID":"5","title":"Drink More Beer!","location":"Different Frat Houses","datetime":"12/13/14"}]}')

	end
	
	def list
	end

	def new
	end

	def getMeetings
		require 'net/http'
		url = URI.parse('http://csse371-04.csse.rose-hulman.edu/User/Meetings/' + @userID)
		req = Net::HTTP::Get.new(url.path)
		res = Net::HTTP.start(url.host, url.port) {|http|
			http.request(req)
		}
		getUserMeetings = JSON.parse(res.body)
		@meetings = Array.new
		@meetingsParsed = Array.new
		@meetingString = ''

		getUserMeetings['meetings'].each do |meeting|
			url = URI.parse('http://csse371-04.csse.rose-hulman.edu/Meeting/' + meeting['id'].to_s)
			req = Net::HTTP::Get.new(url.path)
			res = Net::HTTP.start(url.host, url.port) {|http|
				http.request(req)
			}
			@meetingString = res.body
			meetingIdString = ',"meetingID":"'+meeting['id'].to_s+'"}';

			@meetingString = @meetingString[0..-2] + meetingIdString;

			@meetings.push(@meetingString)
			@meetingsParsed.push(JSON.parse(@meetingString))
		end

		
	end

	layout 'slate'
end
